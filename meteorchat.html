<head>
    <title>MeteorChat</title>
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css" />
    <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js"></script>
    <script src="http://connect.facebook.net/ja_JP/all.js"></script>
    <script type="text/javascript">
        $(function(){            
            var APP_ID = '431711670200752'; 
            FB.init({
                appId: APP_ID,
                status: true,
                cookie: true,
                xfbml: true,
                oauth: true
            });
            
            FB.getLoginStatus(function(response) {
                if (response.session) {
                }else{
                    FB.login(function(response) {
                        FB.api('/me&locale=ja_JP', function(response) {
                            var img_url = "https://graph.facebook.com/"+ response.id +"/picture";
                            $('#msg_frm').append("<img src='" + img_url + "'>");
                        });
                    },{});
                }
            });
            
            $('#messagelog').live('DOMNodeInserted', function(event) {
                $('#messagelog').listview('refresh');
                $('input#message_text').val('');
            $('input#message_text').focus();
            });
        });
        
    </script>
</head>

<body>
    <h1>MeteorChat</h1>
    <div id="fb-root"></div>
    <div id="outer">
        {{> post_form}}
        {{> messages}}
    </div>

</body>

<template name="post_form">
    <table id="frm_table">
        <tr>
            <td><div id="msg_frm"></div></td>
            <td><input type="text" id="message_text"name="message_text"></td>
            <td><input type="button" id="submit" name="submit" value="submit"></td>
        </tr>
    </table>
</template>

<template name="messages">
    <h2>MessageLog</h2>
    <ul id="messagelog" data-role="listview">
        {{#each messagelog}}
        <li>{{> message}}</li>
        {{/each}}
    </ul>
</template>

<template name="message">
    <div>
        <img src="https://graph.facebook.com/{{id}}/picture">
        <span>{{message}}</span>
        <div>
            <span>{{name}}</span>
            <span>{{post_date}}</span>
        </div>
    </div>
</template>

